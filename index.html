<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seismic Data Visualization</title>
</head>
<body>
    <h1>Seismic Data Visualization</h1>
    <input type="file" id="fileInput" accept=".csv">
    <button onclick="processCSV()">Process CSV</button>
    <canvas id="waveformCanvas" width="1000" height="500"></canvas> <!-- 用來顯示波形圖的 Canvas -->

    <script>
        // 处理 CSV 文件并绘制波形图
        function processCSV() {
            const fileInput = document.getElementById('fileInput');
            if (!fileInput.files.length) {
                alert("Please upload a CSV file.");
                return;
            }

            const csvFile = fileInput.files[0];
            const reader = new FileReader();
            reader.onload = function(event) {
                const csvData = event.target.result;
                const data = parseCSV(csvData);
                drawWaveform(data);
            };
            reader.readAsText(csvFile);
        }

        // 将 CSV 文件解析成數字數據
        function parseCSV(csvData) {
            const rows = csvData.split('\n');
            const data = rows.map(row => {
                const values = row.split(',');
                return parseFloat(values[2]); // 提取第三列 velocity(m/s)
            }).filter(value => !isNaN(value)); // 過濾掉無效值
            return data;
        }

        // 使用 Canvas 绘制波形图
        function drawWaveform(data) {
            const canvas = document.getElementById('waveformCanvas');
            const ctx = canvas.getContext('2d');
            const canvasWidth = canvas.width;
            const canvasHeight = canvas.height;

            // 清空画布
            ctx.clearRect(0, 0, canvasWidth, canvasHeight);

            // 計算數據範圍，最大和最小值
            const maxValue = Math.max(...data);
            const minValue = Math.min(...data);
            const range = maxValue - minValue;

            // 計算每個點之間的水平距離
            const stepX = canvasWidth / data.length;

            // 計算垂直位置的縮放
            const scaleY = canvasHeight / range;

            // 將波形數據映射到畫布上
            ctx.beginPath();
            ctx.moveTo(0, (data[0] - minValue) * scaleY);

            for (let i = 1; i < data.length; i++) {
                const x = i * stepX;
                const y = (data[i] - minValue) * scaleY;
                ctx.lineTo(x, canvasHeight - y); // 反轉 Y 軸繪製
            }

            ctx.strokeStyle = 'blue';
            ctx.lineWidth = 1;
            ctx.stroke();
        }
    </script>
</body>
</html>
