<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seismic Data Visualization</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> <!-- 加载 Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom"></script> <!-- 加载缩放/平移插件 -->
</head>
<body>
    <h1>Seismic Data Visualization</h1>
    <input type="file" id="fileInput" accept=".csv">
    <button onclick="processCSV()">Process CSV</button>
    <canvas id="waveformCanvas" width="600" height="400"></canvas> <!-- 用來顯示波形圖的 Canvas -->

    <script>
        // 創建 Web Worker 用於處理 CSV 數據
        const worker = new Worker('dataProcessor.js');

        // 當數據處理完成後從 Web Worker 接收數據並繪製波形圖
        worker.onmessage = function(e) {
            const processedData = e.data;
            drawWaveform(processedData); // 繪製波形圖
        };

        // 用於處理 CSV 文件
        function processCSV() {
            const fileInput = document.getElementById('fileInput');
            if (!fileInput.files.length) {
                alert("Please upload a CSV file.");
                return;
            }

            const csvFile = fileInput.files[0];
            const reader = new FileReader();
            reader.onload = function(event) {
                const csvData = event.target.result;
                worker.postMessage(csvData); // 將 CSV 數據發送給 Web Worker 進行處理
            };
            reader.readAsText(csvFile);
        }

        // 使用 Chart.js 繪製波形圖
        function drawWaveform(data) {
            const ctx = document.getElementById('waveformCanvas').getContext('2d');
            
            // 初始顯示部分數據
            const initialData = data.slice(0, 1000); // 只顯示前 1000 個點
            const labels = initialData.map((_, index) => index); // 使用索引作为X轴标签
            
            const chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Waveform',
                        data: initialData,
                        borderColor: 'blue',
                        borderWidth: 2,
                        fill: false,
                    }]
                },
                options: {
                    scales: {
                        x: {
                            type: 'linear',
                            position: 'bottom'
                        }
                    },
                    plugins: {
                        zoom: {
                            pan: {
                                enabled: true,
                                mode: 'x',
                            },
                            zoom: {
                                enabled: true,
                                mode: 'x',
                                onZoom: function({chart}) {
                                    // 在缩放事件上动态载入数据
                                    const xAxisRange = Math.max(0, chart.scales.x.min);
                                    const yAxisRange = Math.min(chart.scales.x.max, data.length);

                                    // 动态加载在可视区域的数据
                                    const visibleData = data.slice(xAxisRange, yAxisRange);
                                    chart.data.labels = visibleData.map((_, index) => index + xAxisRange);
                                    chart.data.datasets[0].data = visibleData;
                                    chart.update();
                                }
                            }
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>
